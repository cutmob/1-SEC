# ── 1SEC Helm Chart — Default Values ────────────────────────────────────────
# Override with: helm install 1sec ./deploy/helm -f my-values.yaml

replicaCount: 1

image:
  repository: ghcr.io/cutmob/1-sec
  pullPolicy: IfNotPresent
  tag: ""  # Defaults to Chart.appVersion

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# ── Service ──────────────────────────────────────────────────────────────────
service:
  type: ClusterIP
  apiPort: 1780
  natsPort: 4222
  syslogPort: 1514

# ── Ingress (optional — expose the REST API externally) ──────────────────────
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: 1sec.example.com
      paths:
        - path: /api
          pathType: Prefix
  tls: []
  # - secretName: 1sec-tls
  #   hosts:
  #     - 1sec.example.com

# ── Resources ────────────────────────────────────────────────────────────────
resources:
  limits:
    cpu: "2"
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 64Mi

# ── Persistence (NATS JetStream data) ────────────────────────────────────────
persistence:
  enabled: true
  storageClass: ""  # Use cluster default
  accessMode: ReadWriteOnce
  size: 5Gi
  mountPath: /data/nats

# ── Environment / Secrets ────────────────────────────────────────────────────
# PRODUCTION: Use existingSecret (below) instead of inline env values.
# Create the secret separately via Sealed Secrets, External Secrets Operator,
# or: kubectl create secret generic 1sec-prod-secrets --from-literal=GEMINI_API_KEY=xxx ...
#
# These inline values are ONLY for quick local testing. Never commit real keys here.
env:
  GEMINI_API_KEY: ""
  GEMINI_API_KEY_2: ""
  GEMINI_API_KEY_3: ""
  ONESEC_CLOUD_KEY: ""
  ONESEC_API_KEY: ""
  ONESEC_RUST_ENGINE: "false"
  ONESEC_LOG_LEVEL: "info"

# Reference an existing Secret instead of inline env vars (RECOMMENDED for production).
# Secret must contain keys matching the env vars above.
existingSecret: ""
# Example: existingSecret: "1sec-prod-secrets"

# ── 1SEC Config override ──────────────────────────────────────────────────────
# Provide a full configs/default.yaml override as a multiline string.
# If empty, the built-in default config is used.
config: ""
# config: |
#   server:
#     port: 1780
#     cors_origins:
#       - "https://1-sec.dev"
#   modules:
#     ai_analysis_engine:
#       enabled: true
#       settings:
#         triage_model: "gemini-flash-lite-latest"
#         deep_model: "gemini-flash-latest"

# ── Pod settings ─────────────────────────────────────────────────────────────
podAnnotations: {}
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

nodeSelector: {}
tolerations: []
affinity: {}

# ── Topology Spread (HA — distribute across zones/nodes) ─────────────────────
# Uncomment for multi-replica HA deployments:
# topologySpreadConstraints:
#   - maxSkew: 1
#     topologyKey: topology.kubernetes.io/zone
#     whenUnsatisfiable: DoNotSchedule
#     labelSelector:
#       matchLabels: {}  # Filled by template

# ── Health probes ─────────────────────────────────────────────────────────────
livenessProbe:
  httpGet:
    path: /api/v1/status
    port: api
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/v1/status
    port: api
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /api/v1/status
    port: api
  initialDelaySeconds: 2
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 10

# ── ServiceAccount ────────────────────────────────────────────────────────────
serviceAccount:
  create: true
  annotations: {}
  name: ""
